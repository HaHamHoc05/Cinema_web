{% extends "base.html" %}

{% block extra_css %}
<style>
    .movie-card {
        transition: transform 0.3s;
        border: 1px solid #444; /* Viền sáng hơn */
        box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    .movie-card:hover {
        transform: translateY(-5px);
        border-color: var(--primary-red);
        box-shadow: 0 10px 20px rgba(255, 30, 30, 0.2);
    }
    .card-img-top {
        height: 350px;
        object-fit: cover;
    }
    /* Badge Lịch chiếu nổi bật */
    .showtime-badge {
        background-color: #333;
        color: #fff;
        border: 1px solid #555;
        font-size: 0.85rem;
        padding: 5px 10px;
        border-radius: 5px;
        margin-right: 5px;
        margin-bottom: 5px;
        display: inline-block;
        text-decoration: none;
        transition: 0.2s;
    }
    .showtime-badge:hover {
        background-color: var(--primary-red);
        border-color: var(--primary-red);
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div class="mb-5 rounded overflow-hidden position-relative shadow-lg">
    <img src="https://wallpapers.com/images/hd/avengers-endgame-desktop-u26252433s2i872o.jpg" class="w-100" style="height: 400px; object-fit: cover; filter: brightness(0.7);">
    <div class="position-absolute bottom-0 start-0 p-5 text-white">
        <h1 class="fw-bold display-4 text-uppercase">Phim Hot Tuần Này</h1>
        <a href="#list" class="btn btn-danger btn-lg mt-2 fw-bold">Mua Vé Ngay</a>
    </div>
</div>

<div id="list" class="d-flex align-items-center mb-4 border-bottom border-secondary pb-2">
    <h2 class="text-uppercase text-white m-0"><i class="fas fa-play-circle text-danger me-2"></i>Phim Đang Chiếu</h2>
</div>

<div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4">
    {% for movie in movies %}
    <div class="col">
        <div class="card movie-card h-100 bg-dark">
            <div class="position-relative">
                <span class="position-absolute top-0 end-0 bg-danger text-white fw-bold px-2 py-1 m-2 rounded shadow">
                    {{ movie.rating }}
                </span>
                <a href="{% url 'movie_detail' movie.id %}">
                    {% if movie.poster %}
                        <img src="{{ movie.poster.url }}" class="card-img-top" alt="{{ movie.title }}">
                    {% else %}
                        <div class="card-img-top bg-secondary d-flex align-items-center justify-content-center">
                            <i class="fas fa-film fa-3x text-dark"></i>
                        </div>
                    {% endif %}
                </a>
            </div>

            <div class="card-body">
                <h5 class="card-title text-truncate mb-1">
                    <a href="{% url 'movie_detail' movie.id %}" class="text-white text-decoration-none fw-bold">
                        {{ movie.title }}
                    </a>
                </h5>
                <p class="text-muted small mb-3">
                    <i class="far fa-clock me-1"></i>{{ movie.duration }} phút
                    | <i class="far fa-calendar me-1"></i>{{ movie.release_date|date:"d/m" }}
                </p>

                <div class="mb-3">
                    <strong class="text-light d-block mb-2 small text-uppercase">Suất chiếu hôm nay:</strong>

                    {% for showtime in movie.showtimes.all|slice:":4" %}
                        {% if showtime.is_available %}
                            <a href="{% url 'showtime_detail' showtime.id %}" class="showtime-badge">
                                {{ showtime.start_time|date:"H:i" }}
                            </a>
                        {% endif %}
                    {% empty %}
                        <span class="text-muted small fst-italic">Chưa có lịch chiếu.</span>
                    {% endfor %}

                    {% if movie.showtimes.count > 4 %}
                        <a href="{% url 'movie_detail' movie.id %}" class="text-danger small fw-bold text-decoration-none ms-1">Xem thêm >></a>
                    {% endif %}
                </div>
            </div>

            <div class="card-footer bg-transparent border-top border-secondary p-3">
                <a href="{% url 'movie_detail' movie.id %}" class="btn btn-outline-danger w-100 fw-bold">
                    CHI TIẾT & ĐẶT VÉ
                </a>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12 text-center py-5">
        <h4 class="text-muted">Không tìm thấy phim nào.</h4>
    </div>
    {% endfor %}
</div>
{% endblock %}